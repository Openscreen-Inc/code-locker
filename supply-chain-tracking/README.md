# Supply Chain Tracking

> Additionnal information regarding this example and other sample applications
> can be found in the [Code Locker][LOCKER] section of the developer [documentation][DOCS].
> Please note that these sample applications are for demonstration purposes only
> and should not be used in production applications.

This sample app provides an example of how to use unique QR Codes generated by
an inventory management system to track items purchased and subsequently rented
out by a furniture rental company. Every time a product is purchased, rented, or
returned, the QR Code provides one-scan updating to the inventory management
system.

The backend API is defined using the [Serverless Framework][SLS] and is configured to deploy
to an [AWS][AWS] account. The fontend UI is built using [ReactJS](https://reactjs.org) and can be served publicly
with the help of [localtunnel](https://github.com/localtunnel/localtunnel).

Additional information about this use case can be found [here.](https://docs.openscreen.com/docs/developer-portal/node-sdk/code-locker/supply-chain-archive/)

## Requirements

- [NodeJS][NODE] v14 or greater
- An [Openscreen][Openscreen] account
- An [AWS][AWS] account

## Installing / Getting started

You can get this code and install the required dependencies by running the
commands below.

```bash
git clone https://github.com/Openscreen-Inc/code-locker.git
cd supply-chain-tracking
npm install
```

### Initial Configuration

Both the backend API and frontend UI are configured using a `.env` file. This
file needs to be created at the top-level of the project under e.g `supply-chain-tracking/.env`
and have the following key value pairs, where the text in angular brackets is replaced
with your values:

```bash
REGION=<VALUE> # default us-east-1
TABLE_NAME=<VALUE> # default supplychain-inventory-demo
BACKEND_URL=<VALUE> # available after deploying the backend API.

PORT=<VALUE> # Used to configure the localtunnel and server, default 5000
SUBDOMAIN=<VALUE> # Set to a fixed value
FRONTEND_URL=<URL> # Available after configuring your localtunnel

OS_KEY=<KEY> # Openscreen project API key
OS_SECRET=<KEY> # Openscreen project API secret
PROJECT_ID=<VALUE> # Openscreen project ID
```

The first set of values relate to the configuration of the AWS account and resources.

- **REGION**: Defines the AWS region for deployment
- **TABLE_NAME**: Defines the DynamoDB table name for furniture inventory database
- **BACKEND_URL**: The API Gateway invocation (available after deploying the backend API)

The second set of values configure the local server and tunnel used by the UI.

- **PORT**: Which local port to use when serving our React app `(e.g http://localhost:5000)`
- **SUBDOMAIN**: Request a named subdomain on the localtunnel. The default is random
   characters which is not helpful in our case since we need a fixed domain for our
   app. You can either pick a custom name or run the tunnel once and set this value
   to the provided subdomain so we can use it again next time we run our tunnel.
- **FRONTEND_URL**: This is a combination of our defined **PORT** and **SUBDOMAIN**
   and is available as the **PUBLIC_URL** after runnning our tunnel.

The last set of keys relates to your Openscreen account and project and can be
found after you've signed into your Openscreen [dashboard][DASH].

- **OS_KEY:** Your Openscreen project API key
- **OS_SECRET:** Your Openscreen project API key secret
- **PROJECT_ID :** Your Openscreen project ID

## Developing

After creating and your `.env` configuration file and setting the **PORT** and
**SUBDOMAIN**, you can get your **FRONTEND_URL** by runnning the following commands
from the root folder:

```bash
cd ui
npm run serve
```

This should generate a similar output as below, where the **PUBLIC_URL** is the
value for the **FRONTEND_URL**, with the value of **SUBDOMAIN** being the value
you configured:

```bash
âžœ npm run serve

> openscreen-supply-chain-ui-demo@1.0.0 serve
> node ./serve.js

[info]  LOCAL URL: http://localhost:5000
[info]  PUBLIC URL: https://{SUBDOMAIN}.loca.lt
[info]  Serving files from: /some/directory/supply-chain-furniture/ui/dist
------------------------------------------------
```

Next we can deploy our backend api by running these commands from the root folder:

```bash
cd api
npm run deploy
```

Which will return our **BACKEND_URL** in the console similar to:

```bash
Service Information
service: supplychain-backend
stage: demo
region: us-east-1
stack: supplychain-backend-demo
resources: 36
api keys:
  None
endpoints:
  GET - https://ffffffffff.execute-api.us-east-1.amazonaws.com/demo/scan/{id}
  GET - https://ffffffffff.execute-api.us-east-1.amazonaws.com/demo/
  GET - https://ffffffffff.execute-api.us-east-1.amazonaws.com/demo/{id}
  DELETE - https://ffffffffff.execute-api.us-east-1.amazonaws.com/demo/{id}
  POST - https://ffffffffff.execute-api.us-east-1.amazonaws.com/demo/
  PATCH - https://ffffffffff.execute-api.us-east-1.amazonaws.com/demo/
```

The **BACKEND_URL** in this case is `https://ffffffffff.execute-api.us-east-1.amazonaws.com/demo/`
which we can now set in our `.env` config.

With our `.env` config file set, we can start the development server for the
UI by running `npm run start` from the root folder or:

```bash
cd ui
npm run start
```

### Building

Before publicly serving our UI via a the localtunnel and public url, we need to
build our UI assets. The following commands will build our UI then serve it using
our local tunnel.

```bash
cd ui
npm run build
npm run serve
```

You can also run `npm run serve` from the root foler.

The application should now be publicly available by navigating to the **PUBLIC_URL**
in any browser.

## Links

- [Openscreen website][Openscreen]
- [Developer Documentation][DOCS]
- [JavaScript SDK][SDK]
- [Additional Examples and Use Cases][LOCKER]

[Openscreen]: https://www.openscreen.com
[DASH]: https://www.app.openscreen.com
[SDK]: https://github.com/openscreen-tv/openscreen-sdk
[LOCKER]: https://docs.openscreen.com/docs/developer-portal/node-sdk/code-locker/overview/
[DOCS]: https://docs.openscreen.com/docs/
[NODE]: https://nodejs.org/en/
[SLS]: https://www.serverless.com
[AWS]: https://aws.amazon.com
